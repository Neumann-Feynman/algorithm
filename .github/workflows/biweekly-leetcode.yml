name: Biweekly LeetCode Report (Bun, multi-user)

on:
  schedule:
    # â° ë§¤ 2ì£¼ë§ˆë‹¤ KST(UTC+9) ìì •ì— ê°€ê¹ê²Œ ì‹¤í–‰í•˜ë ¤ë©´:
    # ìì • KST ~= 15:00 UTC ì „ë‚  â†’ 2ì£¼ ê°„ê²©: */14 ì‚¬ìš©
    - cron: "0 15 */14 * *"
  workflow_dispatch: {}

permissions:
  contents: write # reports/* ì»¤ë°‹ì„ ìœ„í•´ í•„ìš”

jobs:
  report:
    runs-on: self-hosted # ë„ì»¤ APIê°€ ê°™ì€ ë¨¸ì‹ ì—ì„œ localhost:3000 ìœ¼ë¡œ ì—´ë ¤ ìˆì–´ì•¼ í•¨
    env:
      # âœ… ê³µí†µ ê¸°ë³¸ê°’(Secrets ë¯¸ì„¤ì • ì‹œ fallback)
      TARGET_2WEEKS: "20"
      TZ: Asia/Seoul
      DEDUPE_MODE: WINDOW_UNIQUE # DAILY_UNIQUE | WINDOW_UNIQUE | ALL_SUBMISSIONS
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: "1.1.29"

      # (ì˜ì¡´ì„± ì—†ìœ¼ë©´ install ìŠ¤í… ìƒëµ ê°€ëŠ¥)
      # - name: Install deps
      #   run: bun install

      - name: Run biweekly report
        env:
          # ğŸ” í•„ìˆ˜ Secrets
          API_BASE: ${{ secrets.API_BASE }} # ì˜ˆ: http://localhost:3000
          USERS: ${{ secrets.USERS }} # ì˜ˆ: moo,ryu  (ì½¤ë§ˆ êµ¬ë¶„)
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          TARGET_2WEEKS: ${{ env.TARGET_2WEEKS }}
          TZ: ${{ env.TZ }}
          DEDUPE_MODE: ${{ env.DEDUPE_MODE }}
        run: bun scripts/run-biweekly.ts

      - name: Commit & push report
        run: |
          git config user.name "gh-bot"
          git config user.email "actions@users.noreply.github.com"
          git add reports/
          git commit -m "chore(report): biweekly" || echo "No changes"
          git push
